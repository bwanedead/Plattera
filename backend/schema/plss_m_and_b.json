{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "PlatteraParcel",
    "type": "object",
    "required": ["parcel_id", "descriptions", "source"],
    "additionalProperties": false,
    "properties": {
      "parcel_id": { 
        "type": "string", 
        "description": "Unique parcel identifier" 
      },

      "descriptions": {
        "type": "array",
        "description": "Array of property descriptions (multiple 'Beginning at' clauses)",
        "items": {
          "type": "object",
          "required": ["description_id", "is_complete", "area_stated", "area_units", "plss", "metes_and_bounds"],
          "additionalProperties": false,
          "properties": {
            "description_id": { 
              "type": "integer", 
              "minimum": 1, 
              "description": "1-based index of this description" 
            },
            "is_complete": { 
              "type": "boolean", 
              "description": "Whether description has sufficient info for mapping" 
            },
            "area_stated": { 
              "type": ["number", "null"], 
              "description": "Area as stated in deed (numeric only)" 
            },
            "area_units": { 
              "type": ["string", "null"], 
              "description": "Area units exactly as written" 
            },
            
            "plss": {
              "type": "object",
              "description": "Public Land Survey System information",
              "required": ["state", "county", "principal_meridian", "township_number", "township_direction", "range_number", "range_direction", "section_number", "quarter_sections", "starting_point"],
              "additionalProperties": false,
              "properties": {
                "state": { 
                  "type": ["string", "null"], 
                  "description": "State name exactly as written" 
                },
                "county": { 
                  "type": ["string", "null"], 
                  "description": "County name exactly as written" 
                },
                "principal_meridian": { 
                  "type": ["string", "null"], 
                  "description": "Principal meridian exactly as written" 
                },
                "township_number": { 
                  "type": ["integer", "null"], 
                  "description": "Township number (extract only the number)" 
                },
                "township_direction": { 
                  "type": ["string", "null"], 
                  "enum": ["N", "S", null], 
                  "description": "Township direction: N or S only" 
                },
                "range_number": { 
                  "type": ["integer", "null"], 
                  "description": "Range number (extract only the number)" 
                },
                "range_direction": { 
                  "type": ["string", "null"], 
                  "enum": ["E", "W", null], 
                  "description": "Range direction: E or W only" 
                },
                "section_number": { 
                  "type": ["integer", "null"], 
                  "minimum": 1, 
                  "maximum": 36, 
                  "description": "Section number (1-36)" 
                },
                "quarter_sections": { 
                  "type": ["string", "null"], 
                  "description": "Quarter-section description exactly as written" 
                },
                
                "starting_point": {
                  "type": "object",
                  "description": "Point of Beginning information",
                  "required": ["pob_status", "latitude", "longitude", "tie_to_corner", "raw_text"],
                  "additionalProperties": false,
                  "properties": {
                    "pob_status": { 
                      "type": "string", 
                      "enum": ["explicit", "deducible", "ambiguous"], 
                      "description": "explicit=lat/lon given, deducible=bearing/distance from corner, ambiguous=unclear" 
                    },
                    "latitude": { 
                      "type": ["number", "null"], 
                      "description": "If explicit coordinates given" 
                    },
                    "longitude": { 
                      "type": ["number", "null"], 
                      "description": "If explicit coordinates given" 
                    },
                      "tie_to_corner": {
                      "type": ["object", "null"],
                      "description": "If deducible from PLSS corner",
                       "required": ["corner_label", "bearing_raw", "distance_value", "distance_units", "reference_plss", "tie_direction"],
                      "additionalProperties": false,
                      "properties": {
                        "corner_label": { 
                          "type": "string", 
                          "description": "PLSS corner description exactly as written" 
                        },
                         "reference_plss": {
                           "type": ["object", "null"],
                           "description": "If the tie references a different TRS than the container parcel",
                           "required": ["principal_meridian", "section_number", "township_number", "township_direction", "range_number", "range_direction"],
                           "additionalProperties": false,
                           "properties": {
                             "principal_meridian": { "type": ["string", "null"], "description": "Principal meridian for the reference corner" },
                             "section_number": { "type": "integer", "minimum": 1, "maximum": 36 },
                             "township_number": { "type": "integer", "minimum": 1 },
                             "township_direction": { "type": "string", "enum": ["N", "S"] },
                             "range_number": { "type": "integer", "minimum": 1 },
                             "range_direction": { "type": "string", "enum": ["E", "W"] }
                           }
                         },
                        "bearing_raw": { 
                          "type": "string", 
                          "description": "Bearing exactly as written (e.g., 'N. 4°00'W.')" 
                        },
                        "distance_value": { 
                          "type": "number", 
                          "description": "Distance value (extract only the number)" 
                        },
                        "distance_units": { 
                          "type": "string", 
                          "description": "Distance units exactly as written" 
                         },
                         "tie_direction": {
                           "type": ["string", "null"],
                           "enum": ["corner_bears_from_pob", "pob_bears_from_corner", null],
                           "description": "Disambiguate deed grammar. If 'corner_bears_from_pob', add 180° to compute POB from corner."
                         }
                      }
                    },
                    "raw_text": { 
                      "type": "string", 
                      "description": "Exact POB text from deed" 
                    }
                  }
                }
              }
            },
            
            "metes_and_bounds": {
              "type": "object",
              "description": "Property boundary course information",
              "additionalProperties": false,
              "properties": {
                "pob_vertex_index": {
                  "type": ["integer", "null"],
                  "minimum": 0,
                  "description": "Index of POB in boundary sequence; if set, backend will avoid renormalizing to vertex 0"
                },
                "legs_total": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Count of boundary legs in this description"
                },
                "boundary_courses": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": [
                      "leg_id", "course", "bearing_degrees",
                      "distance", "distance_units",
                      "raw_text", "description"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "leg_id": {
                        "type": "integer",
                        "minimum": 1,
                        "description": "1-based index of this leg inside the description"
                      },
                      "course": { 
                        "type": ["string", "null"], 
                        "description": "Course exactly as written (e.g., 'N. 68°30'E.')" 
                      },
                      "bearing_degrees": { 
                        "type": ["number", "null"], 
                        "description": "DO NOT CONVERT - leave as null for LLM extraction" 
                      },
                      "distance": { 
                        "type": ["number", "null"], 
                        "description": "Distance value as stated (extract only the number)" 
                      },
                      "distance_units": { 
                        "type": ["string", "null"], 
                        "description": "Units exactly as written (e.g., 'feet')" 
                      },
                      "raw_text": { 
                        "type": ["string", "null"], 
                        "description": "Exact leg text from deed" 
                      },
                      "description": { 
                        "type": ["string", "null"], 
                        "description": "Context exactly as written (e.g., 'parallel to and 50 feet distant from center line')" 
                      }
                    }
                  }
                },
                "closes_to_start": { 
                  "type": ["boolean", "null"], 
                  "description": "Whether description closes back to starting point" 
                },
                "raw_text": { 
                  "type": ["string", "null"], 
                  "description": "Full legal boundary text from deed" 
                }
              },
              "required": ["boundary_courses", "legs_total", "closes_to_start", "raw_text", "pob_vertex_index"]
            }
          }
        }
      },

      "source": { 
        "type": ["string", "null"], 
        "description": "Deed reference/citation if stated" 
      }
    },
    "version": "parcel_v0.2"
} 